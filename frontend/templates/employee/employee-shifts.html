<!DOCTYPE html>
<html lang="en">
<head>
  {% include "partials/head.html" with page_title="ShiftSync - My Shifts" page_description="ShiftSync - Employee shift calendar" %}
	</head>
	<body>
	  {% include "partials/toast_messages.html" %}

	  {% include "partials/header.html" with nav_active="employee_shifts" %}

		  <main class="main-content main-content-tight-top">
		    {% include "partials/employee_calendar_toolbar.html" with toolbar_variant="views" prev_aria_label="Previous period" next_aria_label="Next period" %}

		    <!-- Month View -->
		    <div class="card mt-3{% if view != 'month' %} hidden{% endif %}" id="monthView">
		      <div class="calendar-grid calendar-grid-month" id="employeeMonthGrid" aria-label="Month calendar"></div>
	    </div>

	    <!-- Week View -->
	    <div class="card mt-3{% if view != 'week' %} hidden{% endif %}" id="weekView">
	      <div class="calendar-grid calendar-grid-week" id="employeeWeekGrid" aria-label="Week calendar"></div>
	    </div>

	    <!-- Upcoming shifts list (small, helpful for Month view) -->
	    <div class="card mt-3">
	      <div class="card-header card-header-tight">
	        <h3 class="card-title">Upcoming shifts</h3>
	      </div>
      <div class="card-content">
        <div class="table-container">
	          <table class="table" aria-label="Upcoming shifts">
	            <thead>
	              <tr>
	                <th>Date</th>
	                <th>Time</th>
	                <th>Hours</th>
	              </tr>
	            </thead>
	            <tbody>
	              {% for item in upcoming %}
	                {% with s=item.shift %}
	                  <tr style="cursor:pointer;" onclick="openShiftDetails({{ s.id }})">
	                    <td>{{ s.date|date:"D, M j" }}</td>
	                    <td>{{ s.start_time|time:"H:i" }}–{{ s.end_time|time:"H:i" }}</td>
	                    <td>{{ item.hours|floatformat:1 }}h</td>
	                  </tr>
	                {% endwith %}
	              {% empty %}
	                <tr>
	                  <td colspan="3" class="text-sm text-muted">No upcoming shifts.</td>
	                </tr>
	              {% endfor %}
	            </tbody>
	          </table>
        </div>
      </div>
    </div>

  </main>

  <!-- Month mini popup (compact) -->
  <div class="modal-overlay hidden" id="monthPopupModal">
    <div class="modal" style="max-width: 420px;">
      <div class="modal-header">
        <h2 class="modal-title">Shift</h2>
        <button class="modal-close" onclick="closeModal('monthPopupModal')" aria-label="Close">
          {% include "partials/icons/x.html" %}
        </button>
      </div>
      <div class="modal-body">
        <div class="font-medium" id="monthPopupDate">Mon, Jan 13</div>
        <div class="text-sm text-muted mt-1" id="monthPopupTime">06:00–14:00</div>
        <div class="text-sm text-muted mt-2" id="monthPopupHours">Total: 8h</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('monthPopupModal')">Close</button>
        <button class="btn btn-primary" onclick="openShiftDetails(activeMonthPopupId)">Details</button>
      </div>
    </div>
  </div>

  <!-- Shift Details Modal (read-only for employee) -->
  <div class="modal-overlay hidden" id="shiftDetailsModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Shift details</h2>
        <button class="modal-close" onclick="closeModal('shiftDetailsModal')" aria-label="Close">
          {% include "partials/icons/x.html" %}
        </button>
      </div>
      <div class="modal-body">
        <div class="font-medium" id="detailDate">Monday, January 13, 2025</div>
        <div class="text-sm text-muted mt-1" id="detailTime">06:00–14:00</div>
        <div class="flex items-center gap-2 mt-3">
          <span class="badge badge-default" id="detailRole">Barista</span>
          <span class="text-sm text-muted" id="detailHours">8 hours</span>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeModal('shiftDetailsModal')">Close</button>
      </div>
    </div>
  </div>
  
	  <script type="application/json" id="employeeShiftsData"> </script>
	  <div
	    id="employeeShiftPage"
    data-view="{{ view }}"
    data-anchor="{{ anchor|date:'Y-m-d' }}"
    data-start="{{ start|date:'Y-m-d' }}"
    data-end="{{ end|date:'Y-m-d' }}"
    data-today="{{ today|date:'Y-m-d' }}"
  ></div>

  {% include "partials/scripts.html" with include_calendar=1 page_script="js/employee-shifts.js" %}
</body>
</html>
